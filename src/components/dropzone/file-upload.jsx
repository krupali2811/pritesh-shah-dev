import { useCallback } from "react";
import { useDropzone } from "react-dropzone";
import { toast } from "react-toastify";

const FileUpload = ({ setFiles }) => {
  const onDrop = useCallback((acceptedFiles) => {
    setFiles((prevFiles) => [
      ...prevFiles,
      ...acceptedFiles.map((file) =>
        Object.assign(file, { preview: URL.createObjectURL(file) })
      ),
    ]);
  }, [setFiles]);

  const { getRootProps, getInputProps, isDragActive } = useDropzone({
    onDrop,
    // accept: ".csv, .xls, .xlsx",
    multiple: true,
  });

  const handleFileSelect = (event) => {
    const files = event.target.files;
    if (files) {
      onDrop(Array.from(files));
      toast.success("File uploaded successfully");
    }
  };

  return (
    <div
      {...getRootProps()}
      className={`drag-area ${isDragActive ? "active" : ""}`}
    >
      <div className="icon">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="70"
          height="69"
          viewBox="0 0 70 69"
          fill="none"
        >
          <circle cx="35.1597" cy="34.5" r="34.5" fill="#0061FE" />
          <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M28.4738 29.7769C28.4774 30.4285 27.952 30.9597 27.3004 30.9633C25.5803 30.9728 24.3609 31.0176 23.4356 31.1877C22.5439 31.3516 22.0278 31.6147 21.6451 31.9974C21.2093 32.4332 20.9254 33.0446 20.7702 34.1987C20.6103 35.3869 20.6078 36.9615 20.6078 39.2194V40.7926C20.6078 43.0512 20.6103 44.6259 20.7702 45.8141C20.9254 46.968 21.2093 47.5799 21.6456 48.0166C22.0802 48.451 22.6913 48.7346 23.8456 48.8897C25.0341 49.0493 26.6093 49.0518 28.8671 49.0518H41.4526C43.7104 49.0518 45.2856 49.0493 46.4741 48.8897C47.6289 48.7346 48.24 48.4508 48.6746 48.0162C49.1103 47.5804 49.3943 46.969 49.5495 45.8147C49.7094 44.6263 49.7119 43.0512 49.7119 40.7926V39.2194C49.7119 36.9615 49.7094 35.3869 49.5495 34.1987C49.3943 33.0446 49.1104 32.4332 48.6746 31.9974C48.2919 31.6147 47.7758 31.3516 46.8841 31.1877C45.9588 31.0176 44.7394 30.9728 43.0193 30.9633C42.3677 30.9597 41.8423 30.4285 41.8459 29.7769C41.8495 29.1253 42.3807 28.5999 43.0323 28.6035C44.7339 28.6129 46.152 28.6538 47.3107 28.8668C48.5031 29.086 49.5178 29.5033 50.3432 30.3288C51.2903 31.2759 51.6978 32.4681 51.8883 33.8842C52.0717 35.248 52.0717 36.9819 52.0717 39.133V40.879C52.0717 43.0309 52.0717 44.7652 51.8883 46.1292C51.6978 47.5455 51.2903 48.7377 50.3432 49.6848C49.3966 50.6314 48.2041 51.0383 46.7883 51.2285C45.4243 51.4117 43.6901 51.4117 41.5388 51.4116H28.7809C26.6296 51.4117 24.8954 51.4117 23.5314 51.2285C22.1156 51.0383 20.9231 50.6314 19.9765 49.6848C19.0299 48.7371 18.6219 47.5449 18.4314 46.1286C18.248 44.7648 18.248 43.0309 18.248 40.879V39.1331C18.248 36.9819 18.248 35.248 18.4314 33.8842C18.6219 32.4681 19.0294 31.2759 19.9765 30.3288C20.8019 29.5033 21.8166 29.086 23.009 28.8668C24.1677 28.6538 25.5858 28.6129 27.2874 28.6035C27.939 28.5999 28.4702 29.1253 28.4738 29.7769Z"
            fill="white"
          />
          <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M35.1597 17.5884C35.5042 17.5884 35.8314 17.7389 36.0556 18.0004L40.7752 23.5066C41.1992 24.0013 41.1419 24.7462 40.6472 25.1703C40.1524 25.5944 39.4076 25.5371 38.9835 25.0423L36.3396 21.9578V39.2197C36.3396 39.8714 35.8114 40.3996 35.1597 40.3996C34.5081 40.3996 33.9798 39.8714 33.9798 39.2197V21.9578L31.336 25.0423C30.9119 25.5371 30.1671 25.5944 29.6723 25.1703C29.1775 24.7462 29.1202 24.0013 29.5443 23.5066L34.2639 18.0004C34.4881 17.7389 34.8153 17.5884 35.1597 17.5884Z"
            fill="white"
          />
        </svg>
      </div>
      <span className="header">
        Drag & Drop or{" "}
        <label className="button">
          choose file
          <input
            {...getInputProps()}
            type="file"
            onChange={handleFileSelect}
            accept= ".csv, .xls, .xlsx"
            hidden
          />
        </label>{" "}
        to upload
      </span>
      <span className="support">Supported formats: CSV, XLS, XLSX</span>
    </div>
  );
};

export default FileUpload;
